<!doctype html>
<html lang="ja">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>å°å­¦æ ¡ã‹ã‚“ã˜ãƒã‚¹ã‚¿ãƒ¼ çµ±åˆå®Œå…¨ç‰ˆ</title>
  <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&amp;display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
  <style>
        /* --- åŸºæœ¬è¨­å®š (å…ƒã®ã¾ã¾) --- */
        body { box-sizing: border-box; }

        :root {
            --bg-color: #F4F7F6;
            --card-shadow: 0 10px 20px rgba(0,0,0,0.08);
            --g1-color: #FF8A65; --g2-color: #FFD54F; --g3-color: #4FC3F7;
            --g4-color: #81C784; --g5-color: #BA68C8; --g6-color: #7986CB;
        }

        body {
            font-family: 'Mochiy Pop One', sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 0; color: #37474F;
            height: 100vh; overflow: hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åˆ¶å¾¡ã‚’å¤‰æ›´ */
            display: flex; flex-direction: column;
        }

        /* --- ç”»é¢åˆ‡ã‚Šæ›¿ãˆç”¨ã‚³ãƒ³ãƒ†ãƒŠ --- */
        #portal-screen {
            width: 100%; height: 100%; display: flex; flex-direction: column; overflow-y: auto;
        }
        #practice-screen {
            width: 100%; height: 100%; display: none; /* åˆæœŸã¯éè¡¨ç¤º */
            flex-direction: column; background: #fff;
            position: absolute; top: 0; left: 0; z-index: 2000;
        }

        /* --- ä»¥ä¸‹ã€å…ƒã®CSSãã®ã¾ã¾ --- */
        #xp-bar-container {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            padding: 10px 15px;
            display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); z-index: 200; 
            height: 100px; flex-shrink: 0;
            border-bottom: 3px solid #4FC3F7;
        }
        .xp-info { display: flex; align-items: center; gap: 20px; flex-grow: 1; position: relative; }
        
        .char-icon { 
            font-size: 4.2rem;
            animation: big-bounce 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
            cursor: pointer; transition: transform 0.2s;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
            padding: 5px 10px; 
            background: linear-gradient(135deg, rgba(255,255,255,0.8), rgba(200,230,255,0.4)); 
            border-radius: 20px; display: inline-block; margin-left: 5px;
        }
        .char-icon:hover { transform: scale(1.2); filter: drop-shadow(0 6px 12px rgba(79, 195, 247, 0.6)); }
        
        .xp-stats { display: flex; flex-direction: column; gap: 4px; flex-grow: 1; }
        .xp-header { display: flex; align-items: baseline; gap: 10px; }
        .xp-text { font-size: 1.1rem; color: #222; white-space: nowrap; font-weight: 700; }
        
        .xp-desc { 
            font-size: 0.75rem; color: #4FC3F7; font-weight: 700; 
            background: #E1F5FE; padding: 3px 10px; border-radius: 12px;
            display: inline-block; margin-left: 5px;
        }
        .xp-small { font-size: 0.85rem; color: #666; font-weight: 600; text-align: right; margin-right: 15px;}
        
        .progress-track {
            height: 18px; background: #ddd; border-radius: 9px;
            margin: 5px 15px 0 0; overflow: hidden; position: relative; box-shadow: inset 0 2px 5px rgba(0,0,0,0.15);
            width: 95%;
        }
        .progress-fill {
            height: 100%; background: linear-gradient(90deg, #4FC3F7, #29B6F6);
            width: 0%; transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1); border-radius: 8px;
            box-shadow: 0 0 20px rgba(79, 195, 247, 0.8);
        }
        
        @keyframes big-bounce { 
            0%, 100% { transform: translateY(0) scale(1); } 
            50% { transform: translateY(-8px) scale(1.05); } 
        }

        header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px); 
            padding: 10px 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); 
            z-index: 100;
            display: flex; justify-content: space-between; align-items: center;
            height: 60px; flex-shrink: 0;
        }

        .logo { 
            font-size: 1.3rem; display: flex; align-items: center; gap: 8px; 
            color: #2c3e50; font-weight: 700;
        }

        .search-container { 
            position: relative; width: 100%; max-width: 420px; margin: 0 15px; 
        }
        #search-input {
            width: 100%; padding: 10px 18px; border-radius: 30px;
            border: 2px solid #ddd; background: #f5f5f5;
            font-size: 0.95rem; font-family: inherit; outline: none; 
            transition: all 0.3s; font-weight: 600;
        }
        #search-input:focus { 
            background: #fff; border-color: #4FC3F7; 
            box-shadow: 0 0 0 4px rgba(79, 195, 247, 0.25);
        }

        #search-results {
            position: absolute; top: 120%; left: 0; width: 100%;
            background: white; border-radius: 15px;
            box-shadow: 0 10px 35px rgba(0,0,0,0.2);
            max-height: 60vh; overflow-y: auto;
            display: none; padding: 12px; box-sizing: border-box; z-index: 200;
        }
        .result-card {
            display: flex; align-items: center; justify-content: space-between;
            padding: 13px 16px; margin-bottom: 10px; border-radius: 12px; 
            cursor: pointer; border: 2px solid transparent; transition: all 0.2s;
            background: #f8f8f8;
        }
        .result-card:hover { 
            background-color: #e8f4ff; border-color: #4FC3F7; transform: translateX(4px);
        }
        .res-left { display: flex; align-items: center; gap: 13px; }
        .res-char { font-size: 1.8rem; font-weight: bold; width: 42px; text-align: center; }
        .res-reading { font-size: 0.78rem; color: #888; font-weight: 600;}
        .res-badge { 
            padding: 6px 14px; border-radius: 15px; color: white; 
            font-size: 0.85rem; white-space: nowrap; font-weight: 700;
        }

        #home-screen {
            flex-grow: 1; overflow-y: auto; padding: 25px;
            display: flex; flex-direction: column; align-items: center;
        }
        .hero-text { text-align: center; margin: 15px 0 25px; }
        .hero-title { font-size: 1.7rem; margin-bottom: 8px; color: #1a1a1a; font-weight: 800;}
        .hero-subtitle { color: #77a3d1; font-size: 0.9rem; font-weight: 600;}

        .grade-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(135px, 1fr));
            gap: 18px; width: 100%; max-width: 920px; padding-bottom: 25px;
        }
        @media (min-width: 600px) { 
            .grade-grid { grid-template-columns: repeat(3, 1fr); gap: 22px; } 
        }

        .grade-card {
            background: white; border-radius: 22px; padding: 18px;
            text-align: center; cursor: pointer; 
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            transition: all 0.3s; position: relative; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 150px; border: 2px solid transparent;
        }
        .grade-card:hover { transform: translateY(-8px); box-shadow: 0 15px 40px rgba(0,0,0,0.18);}
        .grade-card:active { transform: scale(0.94); }
        .card-icon { font-size: 3.5rem; margin-bottom: 10px; z-index: 2; transition: transform 0.3s;}
        .grade-card:hover .card-icon { transform: scale(1.2) rotate(5deg); }
        .card-title { font-size: 1.15rem; font-weight: 800; color: #333; z-index: 2; }
        .decoration-circle {
            position: absolute; width: 110px; height: 110px; border-radius: 50%;
            opacity: 0.12; z-index: 1; top: -35px; right: -35px;
        }

        .footer-note {
            width: 100%; max-width: 800px; margin-top: 25px; margin-bottom: 20px;
            padding: 18px; background-color: #E8F4FF; border-radius: 12px;
            font-size: 0.75rem; color: #446688; line-height: 1.7; 
            font-family: sans-serif; border-left: 4px solid #4FC3F7;
        }

        .app-credits-container {
            font-family: "Helvetica Neue", Arial, sans-serif;
            width: 100%; max-width: 800px; margin: 0 auto 30px auto;
            padding: 20px; background-color: #ffffff;
            border: 1px solid #e0e0e0; border-radius: 8px; color: #333;
            line-height: 1.6; box-sizing: border-box;
        }
        .credit-warning-box {
            background-color: #fff3cd; border: 1px solid #ffeeba; color: #856404;
            padding: 15px; border-radius: 6px; margin-bottom: 25px;
        }
        .credit-list { list-style: none; padding: 0; margin: 0; }
        .credit-item { margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px dashed #eee; }
        .credit-item:last-child { border-bottom: none; }
        .credit-name { font-weight: bold; font-size: 1.05em; color: #2c3e50; }
        .credit-desc { font-size: 0.9em; color: #555; margin-top: 5px; margin-left: 15px; }
        .license-details { margin-top: 10px; font-size: 0.85em; border: 1px solid #ddd; border-radius: 4px; }
        .license-summary { background-color: #f7f7f7; padding: 10px; cursor: pointer; font-weight: bold; outline: none; }
        .license-full-text {
            padding: 15px; background-color: #fafafa; white-space: pre-wrap;
            font-family: Consolas, monospace; max-height: 300px; overflow-y: auto;
            border-top: 1px solid #ddd; color: #444; font-size: 0.9em;
        }

        .settings-area {
            width: 100%; max-width: 850px; margin-bottom: 80px;
            display: flex; justify-content: flex-end;
        }
        #reset-btn {
            background: #FFEBEE; border: 1px solid #FFCDD2; color: #D32F2F;
            padding: 8px 15px; border-radius: 20px; cursor: pointer;
            font-size: 0.8rem; font-weight: 700; font-family: inherit; transition: all 0.2s;
        }
        #reset-btn:hover { background: #FFCDD2; }

        #change-course-btn {
            position: fixed; bottom: 20px; right: 20px;
            background: linear-gradient(135deg, #fff 0%, #f0f5ff 100%);
            border: 2px solid #4FC3F7; border-radius: 30px;
            padding: 12px 18px; font-family: inherit; font-size: 0.9rem; color: #333;
            cursor: pointer; box-shadow: 0 6px 18px rgba(79, 195, 247, 0.25); 
            z-index: 300; display: flex; align-items: center; gap: 7px; 
            font-weight: 700; transition: all 0.3s;
        }
        #change-course-btn:hover { 
            transform: translateY(-4px); box-shadow: 0 10px 28px rgba(79, 195, 247, 0.4);
            border-color: #29B6F6;
        }
        #change-course-btn:active { transform: scale(0.93); }

        @keyframes xp-gain {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-60px) scale(1.4); }
        }
        .xp-gain-effect {
            position: fixed; pointer-events: none; font-weight: 800; color: #29B6F6;
            font-size: 1.5rem; animation: xp-gain 1.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            text-shadow: 0 0 15px rgba(79, 195, 247, 0.8); z-index: 999;
        }

        #levelup-popup {
            position: fixed; top: 50%; left: 50%; 
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #FFD54F 0%, #FFCA28 100%);
            padding: 35px 50px; border-radius: 25px; text-align: center;
            box-shadow: 0 15px 50px rgba(0,0,0,0.35);
            z-index: 1000; transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 4px solid #fff;
        }
        #levelup-popup.show { transform: translate(-50%, -50%) scale(1); }
        .levelup-text { 
            font-size: 1.6rem; color: #fff; margin: 12px 0; 
            text-shadow: 0 4px 8px rgba(0,0,0,0.25); font-weight: 800;
        }
        .levelup-emoji { 
            font-size: 3.5rem; 
            animation: levelup-bounce 0.7s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        @keyframes levelup-bounce {
            0% { transform: scale(0); }
            70% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }

        #course-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.55); display: none; 
            align-items: center; justify-content: center;
            z-index: 1000; backdrop-filter: blur(4px);
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 25px;
            width: 90%; max-width: 420px; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
        .modal-title { 
            font-size: 1.4rem; margin-bottom: 22px; color: #1a1a1a; font-weight: 800;
        }
        .course-option {
            display: flex; align-items: center; justify-content: space-between;
            background: #f5f5f5; padding: 16px; margin-bottom: 12px;
            border-radius: 14px; cursor: pointer; border: 2px solid transparent;
            transition: all 0.3s;
        }
        .course-option:hover { background: #efefef; transform: translateX(5px); }
        .course-option.active { 
            border-color: #4FC3F7; background: linear-gradient(135deg, #E1F5FE, #B3E5FC);
            box-shadow: 0 4px 15px rgba(79, 195, 247, 0.25);
        }
        .co-icon { font-size: 2rem; }
        .co-name { 
            font-weight: 800; font-size: 1rem; text-align: left; 
            flex-grow: 1; margin-left: 14px; color: #222;
        }
        .co-level { font-size: 0.85rem; color: #888; font-weight: 700; }
        .co-status { font-size: 0.85rem; font-weight: 700; color: #4FC3F7; }

        #modal-close-btn {
            margin-top: 18px; padding: 12px 28px; border-radius: 22px; 
            border: none; background: #4FC3F7; color: white; 
            font-family: inherit; font-weight: 700; cursor: pointer; 
            transition: all 0.2s; font-size: 0.95rem;
        }
        #modal-close-btn:hover { background: #29B6F6; transform: translateY(-2px); }

        #reset-confirm-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.55); display: none; align-items: center;
            justify-content: center; z-index: 1100; backdrop-filter: blur(4px);
        }
        .reset-modal-content {
            background: white; padding: 30px; border-radius: 25px;
            width: 90%; max-width: 380px; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
        .reset-modal-title {
            font-size: 1.3rem; margin-bottom: 15px; color: #D32F2F; font-weight: 800;
        }
        .reset-modal-message {
            font-size: 0.95rem; color: #666; margin-bottom: 25px; line-height: 1.6;
        }
        .reset-button-group { display: flex; gap: 12px; justify-content: center; }
        .reset-confirm-btn {
            flex: 1; padding: 12px 20px; border-radius: 22px; border: none;
            font-family: inherit; font-weight: 700; font-size: 0.9rem;
            cursor: pointer; transition: all 0.2s;
        }
        .reset-cancel-btn { background: #f0f0f0; color: #666; }
        .reset-cancel-btn:hover { background: #e0e0e0; }
        .reset-ok-btn { background: #FF6B6B; color: white; }
        .reset-ok-btn:hover { background: #D32F2F; transform: translateY(-2px); }

        /* --- ã“ã“ã‹ã‚‰è¿½åŠ ï¼šæ›¸ãå–ã‚Šã‚¢ãƒ—ãƒªç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        #practice-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 15px; background: #fff; border-bottom: 2px solid #eee;
        }
        .back-btn {
            background: #eee; border: none; padding: 10px 20px; border-radius: 25px;
            font-family: inherit; font-weight: 800; cursor: pointer; font-size: 1rem;
            color: #555; display: flex; align-items: center; gap: 5px;
        }
        .back-btn:hover { background: #e0e0e0; }
        
        #canvas-area {
            flex: 1; display: flex; align-items: center; justify-content: center;
            background-color: #f0f0f0;
            background-image: linear-gradient(45deg, #e8e8e8 25%, transparent 25%, transparent 75%, #e8e8e8 75%, #e8e8e8),
            linear-gradient(45deg, #e8e8e8 25%, transparent 25%, transparent 75%, #e8e8e8 75%, #e8e8e8);
            background-size: 20px 20px; background-position: 0 0, 10px 10px;
            position: relative;
        }
        
        #drawing-board {
            width: 300px; height: 300px; background: white;
            border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            /* åå­—ãƒªãƒ¼ãƒ€ãƒ¼ç·š */
            background-image: 
                linear-gradient(to right, transparent 49.5%, #ffebee 49.5%, #ffebee 50.5%, transparent 50.5%),
                linear-gradient(to bottom, transparent 49.5%, #ffebee 49.5%, #ffebee 50.5%, transparent 50.5%);
            border: 4px solid #8D6E63;
            cursor: crosshair;
        }

        .controls {
            background: white; padding: 20px;
            border-top: 2px solid #eee; display: flex; flex-direction: column; align-items: center; gap: 15px;
        }
        .kanji-info-display {
            font-size: 1.5rem; font-weight: 800; color: #333;
        }
        .control-buttons { display: flex; gap: 20px; align-items: center; }
        .ctrl-btn {
            width: 60px; height: 60px; border-radius: 50%; border: none;
            font-size: 1.8rem; cursor: pointer; color: white;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2); transition: all 0.1s;
            display: flex; align-items: center; justify-content: center;
        }
        .ctrl-btn:active { transform: translateY(4px); box-shadow: none; }
        .btn-prev { background: #FFD54F; }
        .btn-retry { background: #4FC3F7; }
        .btn-next { background: #FF8A65; }

        .feedback-msg {
            height: 24px; color: #E91E63; font-weight: 800; font-size: 1.1rem;
        }

        @media (max-width: 480px) {
            .hero-title { font-size: 1.4rem; }
            .card-icon { font-size: 3rem; }
            #xp-bar-container { height: 90px; }
            .char-icon { font-size: 3.5rem; }
            #drawing-board { width: 260px; height: 260px; }
        }
    </style>
 </head>
 <body>
  
  <div id="portal-screen">
      <div id="xp-bar-container">
       <div class="xp-info">
        <div class="char-icon" id="current-char" onclick="openCourseModal()" title="ã‚¯ãƒªãƒƒã‚¯ã§ã‚³ãƒ¼ã‚¹å¤‰æ›´ï¼">ğŸ¥š</div>
        <div class="xp-stats">
         <div class="xp-header">
          <div class="xp-text">Lv.<span id="current-lvl">0</span> / 50</div>
          <div class="xp-desc">ã¾ã„ã«ã¡ ã¹ã‚“ãã‚‡ã†ã™ã‚‹ã¨ ãŸã¾ã‚‹ã‚ˆï¼ï¼ˆ1æ—¥5å›ã¾ã§ï¼‰</div>
         </div>
         <div class="progress-track"><div class="progress-fill" id="xp-fill"></div></div>
         <div class="xp-small">ã‚ã¨<span id="next-xp">5</span>å›</div>
        </div>
       </div>
      </div>
    
      <header>
       <div class="logo"><span>ğŸ«</span> æ¼¢å­—ãƒã‚¹ã‚¿ãƒ¼</div>
       <div class="search-container">
           <input type="text" id="search-input" placeholder="ã‹ã‚“ã˜ãƒ»ã‚ˆã¿ï¼ˆä¾‹ï¼šã‹ãŸï¼‰" autocomplete="off">
           <div id="search-results"></div>
       </div>
      </header>
    
      <div id="home-screen">
       <div class="hero-text">
        <div class="hero-title">ã©ã®å­¦å¹´ã‚’ã¯ã˜ã‚ã‚‹ï¼Ÿ</div>
        <div class="hero-subtitle">å…¨1026æ–‡å­— æ›¸ãå–ã‚Šç·´ç¿’ã‚¢ãƒ—ãƒªå†…è”µï¼</div>
       </div>
       <div class="grade-grid">
        <div class="grade-card" onclick="launchApp(1)" style="border-bottom: 5px solid var(--g1-color);">
         <div class="decoration-circle" style="background: var(--g1-color);"></div>
         <div class="card-icon">ğŸ£</div><div class="card-title">1ã­ã‚“ã›ã„</div>
        </div>
        <div class="grade-card" onclick="launchApp(2)" style="border-bottom: 5px solid var(--g2-color);">
         <div class="decoration-circle" style="background: var(--g2-color);"></div>
         <div class="card-icon">ğŸ¹</div><div class="card-title">2ã­ã‚“ã›ã„</div>
        </div>
        <div class="grade-card" onclick="launchApp(3)" style="border-bottom: 5px solid var(--g3-color);">
         <div class="decoration-circle" style="background: var(--g3-color);"></div>
         <div class="card-icon">ğŸ¬</div><div class="card-title">3ã­ã‚“ã›ã„</div>
        </div>
        <div class="grade-card" onclick="launchApp(4)" style="border-bottom: 5px solid var(--g4-color);">
         <div class="decoration-circle" style="background: var(--g4-color);"></div>
         <div class="card-icon">ğŸ¦</div><div class="card-title">4ã­ã‚“ã›ã„</div>
        </div>
        <div class="grade-card" onclick="launchApp(5)" style="border-bottom: 5px solid var(--g5-color);">
         <div class="decoration-circle" style="background: var(--g5-color);"></div>
         <div class="card-icon">ğŸš€</div><div class="card-title">5ã­ã‚“ã›ã„</div>
        </div>
        <div class="grade-card" onclick="launchApp(6)" style="border-bottom: 5px solid var(--g6-color);">
         <div class="decoration-circle" style="background: var(--g6-color);"></div>
         <div class="card-icon">ğŸ‘‘</div><div class="card-title">6ã­ã‚“ã›ã„</div>
        </div>
       </div>
       
       <div class="footer-note">
        <strong>âš ï¸ ä¿è­·è€…ãƒ»å…ˆç”Ÿæ–¹ã¸</strong><br>
        æœ¬ã‚¢ãƒ—ãƒªã¯ã€å­¦ç¿’æ”¯æ´ã®ãŸã‚ã«ä½œæˆã•ã‚ŒãŸã‚‚ã®ã§ã™ã€‚<br>
        æ¼¢å­—ã®ãƒ‡ãƒ¼ã‚¿ã¯æ—¥æœ¬ã®å­¦ç¿’æŒ‡å°è¦é ˜ï¼ˆå…¨1026å­—ï¼‰ã‚’å‚ç…§ã—ã¦ã„ã¾ã™ã€‚
        <div style="margin-top: 10px; padding: 8px; background-color: #f9f9f9; border-left: 4px solid #ffcc00;">
            <strong>ã€åˆ¤å®šã«é–¢ã™ã‚‹ã”æ³¨æ„ã€‘</strong><br>
            ãƒ»ãƒ‡ã‚¸ã‚¿ãƒ«ã®æ¨™æº–å­—ä½“ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€ä¸€éƒ¨ã®æ¼¢å­—ã§æ•™ç§‘æ›¸ã¨ç•°ãªã‚‹å½¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚<br>
            ãƒ»<strong>å­¦æ ¡ã§ç¿’ã£ãŸæ›¸ãæ–¹ãŒæœ€ã‚‚æ­£ã—ã„åŸºæº–ã§ã™ã€‚</strong>ã‚¢ãƒ—ãƒªã®åˆ¤å®šã¯ã‚ãã¾ã§ç›®å®‰ã¨ã—ã¦ã”æ´»ç”¨ãã ã•ã„ã€‚
        </div>
       </div>
    
       <div class="app-credits-container">
        <div class="credit-warning-box">
            <div class="credit-warning-title"><span class="credit-warning-icon">âš ï¸</span> ç­†é †ï¼ˆæ›¸ãé †ï¼‰ã«ã¤ã„ã¦</div>
            <div>
                æœ¬ã‚¢ãƒ—ãƒªã§ã¯æ—¥æœ¬ã®æ¨™æº–çš„ãªç­†é †ã‚’å„ªå…ˆã—ã¦è¡¨ç¤ºã—ã¦ã„ã¾ã™ãŒã€ä¸€éƒ¨ã®æ¼¢å­—ã§ãƒ‡ãƒ¼ã‚¿ã®éƒ½åˆä¸Šã€ç•°ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚<br>
                <strong>å­¦æ ¡ã®æ•™ç§‘æ›¸ã‚„å…ˆç”Ÿã®æŒ‡å°ã¨ç•°ãªã‚‹å ´åˆã¯ã€æ•™ç§‘æ›¸ã‚’æ­£è§£ã¨ã—ã¦ãã ã•ã„ã€‚</strong>
            </div>
        </div>
        <h3 class="credit-section-title">ä½¿ç”¨ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</h3>
        <ul class="credit-list">
            <li class="credit-item">
                <div class="credit-name">1. æ—¥æœ¬èªæ¼¢å­—ãƒ‡ãƒ¼ã‚¿ (hanzi-writer-data-jp)</div>
                <div class="credit-desc">
                    â€¢ Source: <a href="https://github.com/chanind/hanzi-writer-data-jp" target="_blank" class="credit-link">GitHub Repository</a><br>
                    â€¢ Derived from <strong>AnimCJK</strong> (Copyright 2016-2019 FranÃ§ois Mizessyn)<br>
                    â€¢ Licensed under <strong>LGPL v3</strong> or later.<br>
                    â€¢ Original Glyph Data: <strong>Arphic Public License</strong> (Copyright 1999 Arphic Technology Co., Ltd.)
                    <details class="license-details">
                    <summary class="license-summary">â–¶ Arphic Public License å…¨æ–‡ã‚’è¡¨ç¤º</summary>
                    <div class="license-full-text">ARPHIC PUBLIC LICENSE
    (â€»é•·æ–‡ã®ãŸã‚çœç•¥ã—ã¦ã„ã¾ã™ãŒã€å…ƒã®ã‚³ãƒ¼ãƒ‰ã®å†…å®¹ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¨ã—ã¦æ‰±ã„ã¾ã™)
    Copyright (C) 1999 Arphic Technology Co., Ltd.
    All rights reserved.</div>
                    </details>
                </div>
            </li>
            <li class="credit-item">
                <div class="credit-name">2. è¡¨ç¤ºãƒ©ã‚¤ãƒ–ãƒ©ãƒª</div>
                <div class="credit-desc">
                    â€¢ <strong>Hanzi Writer</strong>: <a href="https://chanind.github.io/hanzi-writer/" target="_blank" class="credit-link">Official Site</a>
                </div>
            </li>
        </ul>
       </div>
    
       <div class="settings-area"><button id="reset-btn" onclick="showResetConfirm()">ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ã‚’ã‘ã™ï¼ˆãƒªã‚»ãƒƒãƒˆï¼‰</button></div>
      </div>
      <button id="change-course-btn" onclick="openCourseModal()"><span>ğŸ®</span> ã‚³ãƒ¼ã‚¹ã‚’ã‹ãˆã‚‹</button>
  </div>

  <div id="practice-screen">
      <div id="practice-header">
          <button class="back-btn" onclick="exitApp()">
              <span>â†©</span> ãƒãƒ¼ã‚¿ãƒ«ã«ã‚‚ã©ã‚‹
          </button>
          <div style="font-weight:800; font-size:1.2rem; color:#333;" id="app-grade-label">1ã­ã‚“ã›ã„</div>
          <div style="font-weight:bold; color:#4FC3F7;">Lv.<span class="current-xp-display">0</span></div>
      </div>
      
      <div id="canvas-area">
          <div id="drawing-board"></div>
      </div>

      <div class="controls">
          <div class="feedback-msg" id="feedback-msg"></div>
          <div class="kanji-info-display" id="kanji-info">ä¸€ (ã„ã¡)</div>
          <div class="control-buttons">
              <button class="ctrl-btn btn-prev" onclick="prevChar()">â—€</button>
              <button class="ctrl-btn btn-retry" onclick="retryChar()">â†º</button>
              <button class="ctrl-btn btn-next" onclick="nextChar()">â–¶</button>
          </div>
      </div>
  </div>

  <div id="levelup-popup">
   <div class="levelup-emoji" id="levelup-emoji">âœ¨</div>
   <div class="levelup-text">ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼</div>
   <div class="levelup-text" style="font-size: 1.2rem; opacity: 0.95;" id="levelup-char"></div>
  </div>

  <div id="course-modal" onclick="closeCourseModal(event)">
   <div class="modal-content">
    <div class="modal-title">ğŸ® ã‚³ãƒ¼ã‚¹ã‚’ãˆã‚‰ã‚“ã§ã­</div>
    <div id="course-list"></div><button id="modal-close-btn" onclick="document.getElementById('course-modal').style.display='none'">ã¨ã˜ã‚‹</button>
   </div>
  </div>

  <div id="reset-confirm-overlay">
   <div class="reset-modal-content">
    <div class="reset-modal-title">âš ï¸ ã»ã‚“ã¨ã†ã« ã‘ã—ã¾ã™ã‹ï¼Ÿ</div>
    <div class="reset-modal-message">ãƒ¬ãƒ™ãƒ«ãŒ 0 ã« ãªã‚Šã¾ã™ã€‚<br>ã“ã®æ“ä½œã¯ ã‚‚ã©ã›ã¾ã›ã‚“ã€‚</div>
    <div class="reset-button-group"><button class="reset-confirm-btn reset-cancel-btn" onclick="cancelReset()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button> <button class="reset-confirm-btn reset-ok-btn" onclick="confirmReset()">ãƒ‡ãƒ¼ã‚¿ã‚’ã‘ã™</button></div>
   </div>
  </div>

  <script>
        // --- è¨­å®šãƒ»å¤‰æ•° ---
        const MAX_LEVEL = 50;
        const EVOLUTION_STEP = 5;
        const MAX_DAILY_XP = 5;

        // ã‚³ãƒ¼ã‚¹å®šç¾©ï¼ˆå…ƒã®ã¾ã¾ï¼‰
        const COURSES = {
            A: { name: "å†’é™ºã‚³ãƒ¼ã‚¹", chars: ["ğŸ¥š", "ğŸ£", "ğŸ—¡ï¸", "ğŸ›¡ï¸", "ğŸ´", "ğŸ°", "ğŸ§š", "ğŸ‰", "âš”ï¸", "ğŸ‘‘", "ğŸŒŸ"] },
            B: { name: "è‡ªç„¶ã‚³ãƒ¼ã‚¹", chars: ["ğŸŒ±", "ğŸ’§", "ğŸŒ¿", "ğŸ€", "ğŸ„", "ğŸŒ·", "ğŸŒ»", "ğŸŒ³", "ğŸ", "ğŸ¥§", "ğŸŒˆ"] },
            C: { name: "ä¹—ç‰©ã‚³ãƒ¼ã‚¹", chars: ["ğŸš¶", "ğŸ›´", "ğŸš²", "ğŸ›µ", "ğŸš—", "ğŸšŒ", "ğŸš…", "ğŸš¢", "âœˆï¸", "ğŸš€", "ğŸ›¸"] },
            D: { name: "ã‚¢ã‚¤ãƒ‰ãƒ«", chars: ["ğŸµ", "ğŸ©°", "ğŸ€", "ğŸ’„", "ğŸ‘—", "ğŸ¤", "ğŸ¸", "ğŸ¹", "ğŸ’ƒ", "ğŸ“¸", "ğŸ‘¸"] },
            E: { name: "å’Œé¢¨ãƒ»å¿è€…", chars: ["ğŸµ", "ğŸ™", "ğŸ¥‹", "ğŸ“œ", "ğŸ—¡ï¸", "ğŸ¥·", "ğŸ¯", "ğŸ‘º", "é¬¼", "ğŸŒ", "ğŸŒ¸"] }
        };

        const STORAGE_KEY = 'kanjiMasterProgress_v5';

        // --- æ¼¢å­—ãƒ‡ãƒ¼ã‚¿ (ã“ã“ã«ãƒ•ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼) ---
        // â€»ç¾åœ¨çŸ­ç¸®ç‰ˆã§ã™ã€‚å…ƒã®é•·ã„ãƒ‡ãƒ¼ã‚¿ã‚’ `1|ä¸€:ã„ã¡...` ã®å½¢å¼ã§ã“ã“ã«ä¸Šæ›¸ãã—ã¦ãã ã•ã„ã€‚
        const rawData = `
        1|ä¸€:ã„ã¡,ã„ã¤,ã²ã¨|å³:ã†,ã‚†ã†,ã¿ã|é›¨:ã†,ã‚ã‚,ã‚ã¾|å††:ãˆã‚“,ã¾ã‚‹|ç‹:ãŠã†|éŸ³:ãŠã‚“,ã„ã‚“,ãŠã¨,ã­|ä¸‹:ã‹,ã’,ã—ãŸ,ã—ã‚‚,ã‚‚ã¨,ã•|ç«:ã‹,ã²,ã»|èŠ±:ã‹,ã¯ãª|è²:ã‹ã„|å­¦:ãŒã,ã¾ãª|æ°—:ã,ã‘|ä¹:ãã‚…ã†,ã,ã“ã“ã®|ä¼‘:ãã‚…ã†,ã‚„ã™|ç‰:ãã‚‡ã,ãŸã¾|é‡‘:ãã‚“,ã“ã‚“,ã‹ã­,ã‹ãª|ç©º:ãã†,ãã‚‰,ã‚,ã‹ã‚‰,ã™|æœˆ:ã’ã¤,ãŒã¤,ã¤ã|çŠ¬:ã‘ã‚“,ã„ã¬|è¦‹:ã‘ã‚“,ã¿|äº”:ã”,ã„ã¤|å£:ã“ã†,ã,ãã¡|æ ¡:ã“ã†|å·¦:ã•,ã²ã ã‚Š|ä¸‰:ã•ã‚“,ã¿|å±±:ã•ã‚“,ã‚„ã¾|å­:ã—,ã™,ã“,ã­|å››:ã—,ã‚ˆ,ã‚ˆã‚“,ã‚ˆã£|ç³¸:ã—,ã„ã¨|å­—:ã˜,ã‚ã–|è€³:ã˜,ã¿ã¿|ä¸ƒ:ã—ã¡,ãªãª,ãªã®|è»Š:ã—ã‚ƒ,ãã‚‹ã¾|æ‰‹:ã—ã‚…,ãš,ã¦,ãŸ|å:ã˜ã‚…ã†,ã˜ã£,ã¨ãŠ,ã¨|å‡º:ã—ã‚…ã¤,ã™ã„,ã ,ã§|å¥³:ã˜ã‚‡,ã«ã‚‡,ã«ã‚‡ã†,ãŠã‚“ãª,ã‚|å°:ã—ã‚‡ã†,ã¡ã„,ã“,ãŠ|ä¸Š:ã˜ã‚‡ã†,ã—ã‚‡ã†,ã†ãˆ,ã†ã‚,ã‹ã¿,ã‚,ã®ã¼|æ£®:ã—ã‚“,ã‚‚ã‚Š|äºº:ã˜ã‚“,ã«ã‚“,ã²ã¨|æ°´:ã™ã„,ã¿ãš|æ­£:ã›ã„,ã—ã‚‡ã†,ãŸã ,ã¾ã•|ç”Ÿ:ã›ã„,ã—ã‚‡ã†,ã„,ã†,ãŠ,ã¯,ã,ãªã¾|é’:ã›ã„,ã—ã‚‡ã†,ã‚ãŠ|å¤•:ã›ã,ã‚†ã†|çŸ³:ã›ã,ã—ã‚ƒã,ã“ã,ã„ã—|èµ¤:ã›ã,ã—ã‚ƒã,ã‚ã‹|åƒ:ã›ã‚“,ã¡|å·:ã›ã‚“,ã‹ã‚|å…ˆ:ã›ã‚“,ã•ã,ã¾|æ—©:ãã†,ã•ã£,ã¯ã‚„|è‰:ãã†,ãã•|è¶³:ãã,ã‚ã—,ãŸ|æ‘:ãã‚“,ã‚€ã‚‰|å¤§:ã ã„,ãŸã„,ãŠãŠ|ç”·:ã ã‚“,ãªã‚“,ãŠã¨ã“|ç«¹:ã¡ã,ãŸã‘|ä¸­:ã¡ã‚…ã†,ãªã‹|è™«:ã¡ã‚…ã†,ã‚€ã—|ç”º:ã¡ã‚‡ã†,ã¾ã¡|å¤©:ã¦ã‚“,ã‚ã‚,ã‚ã¾|ç”°:ã§ã‚“,ãŸ|åœŸ:ã©,ã¨,ã¤ã¡|äºŒ:ã«,ãµãŸ|æ—¥:ã«ã¡,ã˜ã¤,ã²,ã‹|å…¥:ã«ã‚…ã†,ã¯ã„,ã„|å¹´:ã­ã‚“,ã¨ã—|ç™½:ã¯ã,ã³ã‚ƒã,ã—ã‚,ã—ã‚‰|å…«:ã¯ã¡,ã‚„,ã‚„ã£,ã‚ˆã†|ç™¾:ã²ã‚ƒã,ã‚‚ã‚‚|æ–‡:ã¶ã‚“,ã‚‚ã‚“,ãµã¿|æœ¨:ã¼ã,ã‚‚ã,ã,ã“|æœ¬:ã»ã‚“,ã‚‚ã¨|å:ã‚ã„,ã¿ã‚‡ã†,ãª|ç›®:ã‚‚ã,ã¼ã,ã‚,ã¾|ç«‹:ã‚Šã¤,ã‚Šã‚…ã†,ãŸ,ã |åŠ›:ã‚Šã‚‡ã,ã‚Šã,ã¡ã‹ã‚‰|æ—:ã‚Šã‚“,ã¯ã‚„ã—|å…­:ã‚ã,ã‚€,ã‚€ã£
ã€€ã€€ã€€  2|å¼•:ã„ã‚“,ã²|ç¾½:ã†,ã¯,ã¯ã­|é›²:ã†ã‚“,ãã‚‚|åœ’:ãˆã‚“,ãã®|é :ãˆã‚“,ãŠã‚“,ã¨ãŠ|ä½•:ã‹,ãªã«,ãªã‚“|ç§‘:ã‹|å¤:ã‹,ã’,ãªã¤|å®¶:ã‹,ã‘,ã„ãˆ,ã‚„|æ­Œ:ã‹,ã†ãŸ|ç”»:ãŒ,ã‹ã|å›:ã‹ã„,ãˆ,ã¾ã‚|ä¼š:ã‹ã„,ãˆ,ã‚|æµ·:ã‹ã„,ã†ã¿|çµµ:ã‹ã„,ãˆ|å¤–:ãŒã„,ã’,ãã¨,ã»ã‹,ã¯ãš|è§’:ã‹ã,ã‹ã©,ã¤ã®|æ¥½:ãŒã,ã‚‰ã,ãŸã®|æ´»:ã‹ã¤|é–“:ã‹ã‚“,ã‘ã‚“,ã‚ã„ã ,ã¾|ä¸¸:ãŒã‚“,ã¾ã‚‹|å²©:ãŒã‚“,ã„ã‚|é¡”:ãŒã‚“,ã‹ãŠ|æ±½:ã|è¨˜:ã,ã—ã‚‹|å¸°:ã,ã‹ãˆ|å¼“:ãã‚…ã†,ã‚†ã¿|ç‰›:ãã‚…ã†,ã†ã—|é­š:ãã‚‡,ã†ãŠ,ã•ã‹ãª|äº¬:ãã‚‡ã†,ã‘ã„,ãã‚“|å¼·:ãã‚‡ã†,ã”ã†,ã¤ã‚ˆ,ã—|æ•™:ãã‚‡ã†,ãŠã—,ãŠã|è¿‘:ãã‚“,ã¡ã‹|å…„:ã‘ã„,ãã‚‡ã†,ã‚ã«|å½¢:ã‘ã„,ãã‚‡ã†,ã‹ãŸ,ã‹ãŸã¡|è¨ˆ:ã‘ã„,ã¯ã‹|å…ƒ:ã’ã‚“,ãŒã‚“,ã‚‚ã¨|è¨€:ã’ã‚“,ã”ã‚“,ã„,ã“ã¨|åŸ:ã’ã‚“,ã¯ã‚‰|æˆ¸:ã“,ã¨|å¤:ã“,ãµã‚‹|åˆ:ã”|å¾Œ:ã”,ã“ã†,ã®ã¡,ã†ã—,ã‚ã¨,ãŠã|èª:ã”,ã‹ãŸ|å·¥:ã“ã†,ã|å…¬:ã“ã†,ãŠãŠã‚„ã‘|åºƒ:ã“ã†,ã²ã‚|äº¤:ã“ã†,ã¾ã˜,ã¾,ã‹|å…‰:ã“ã†,ã²ã‹ã‚Š,ã²ã‹|è€ƒ:ã“ã†,ã‹ã‚“ãŒ|è¡Œ:ã“ã†,ãã‚‡ã†,ã‚ã‚“,ã„,ã‚†,ãŠã“ãª|é«˜:ã“ã†,ãŸã‹|é»„:ã“ã†,ãŠã†,ã,ã“|åˆ:ã”ã†,ãŒã£,ã‹ã£,ã‚|è°·:ã“ã,ãŸã«|å›½:ã“ã,ãã«|é»’:ã“ã,ãã‚|ä»Š:ã“ã‚“,ãã‚“,ã„ã¾|æ‰:ã•ã„|ç´°:ã•ã„,ã»ã,ã“ã¾|ä½œ:ã•ã,ã•,ã¤ã|ç®—:ã•ã‚“|æ­¢:ã—,ã¨,ã‚„|å¸‚:ã—,ã„ã¡|çŸ¢:ã—,ã‚„|å§‰:ã—,ã‚ã­|æ€:ã—,ãŠã‚‚|ç´™:ã—,ã‹ã¿|å¯º:ã˜,ã¦ã‚‰|è‡ª:ã˜,ã—,ã¿ãšã‹|æ™‚:ã˜,ã¨ã|å®¤:ã—ã¤,ã‚€ã‚|ç¤¾:ã—ã‚ƒ,ã‚„ã—ã‚|å¼±:ã˜ã‚ƒã,ã‚ˆã‚|é¦–:ã—ã‚…,ãã³|ç§‹:ã—ã‚…ã†,ã‚ã|é€±:ã—ã‚…ã†|æ˜¥:ã—ã‚…ã‚“,ã¯ã‚‹|æ›¸:ã—ã‚‡,ã‹|å°‘:ã—ã‚‡ã†,ã™ã,ã™ã“|å ´:ã˜ã‚‡ã†,ã°|è‰²:ã—ã‚‡ã,ã—ã,ã„ã‚|é£Ÿ:ã—ã‚‡ã,ã˜ã,ãŸ,ã|å¿ƒ:ã—ã‚“,ã“ã“ã‚|æ–°:ã—ã‚“,ã‚ãŸã‚‰,ã‚ã‚‰,ã«ã„|è¦ª:ã—ã‚“,ãŠã‚„,ã—ãŸ|å›³:ãš,ã¨,ã¯ã‹|æ•°:ã™ã†,ã™,ã‹ãš,ã‹ã|è¥¿:ã›ã„,ã•ã„,ã«ã—|å£°:ã›ã„,ã—ã‚‡ã†,ã“ãˆ,ã“ã‚|æ˜Ÿ:ã›ã„,ã—ã‚‡ã†,ã»ã—|æ™´:ã›ã„,ã¯|åˆ‡:ã›ã¤,ã•ã„,ã|é›ª:ã›ã¤,ã‚†ã|èˆ¹:ã›ã‚“,ãµã­,ãµãª|ç·š:ã›ã‚“|å‰:ãœã‚“,ã¾ãˆ|çµ„:ã,ãã¿|èµ°:ãã†,ã¯ã—|å¤š:ãŸ,ãŠãŠ|å¤ª:ãŸã„,ãŸ,ãµã¨|ä½“:ãŸã„,ã¦ã„,ã‹ã‚‰ã |å°:ã ã„,ãŸã„|åœ°:ã¡,ã˜|æ± :ã¡,ã„ã‘|çŸ¥:ã¡,ã—|èŒ¶:ã¡ã‚ƒ,ã•|æ˜¼:ã¡ã‚…ã†,ã²ã‚‹|é•·:ã¡ã‚‡ã†,ãªãŒ|é³¥:ã¡ã‚‡ã†,ã¨ã‚Š|æœ:ã¡ã‚‡ã†,ã‚ã•|ç›´:ã¡ã‚‡ã,ã˜ã,ãªãŠ,ãŸã |é€š:ã¤ã†,ã¨ãŠ,ã‹ã‚ˆ|å¼Ÿ:ã¦ã„,ã ã„,ã§,ãŠã¨ã†ã¨|åº—:ã¦ã‚“,ã¿ã›|ç‚¹:ã¦ã‚“|é›»:ã§ã‚“|åˆ€:ã¨ã†,ã‹ãŸãª|å†¬:ã¨ã†,ãµã‚†|å½“:ã¨ã†,ã‚|æ±:ã¨ã†,ã²ãŒã—|ç­”:ã¨ã†,ã“ãŸ|é ­:ã¨ã†,ãš,ãƒˆ,ã‚ãŸã¾,ã‹ã—ã‚‰|åŒ:ã©ã†,ãŠãª|é“:ã©ã†,ã¨ã†,ã¿ã¡|èª­:ã©ã,ã¨ã,ã¨ã†,ã‚ˆ|å†…:ãªã„,ã ã„,ã†ã¡|å—:ãªã‚“,ãª,ã¿ãªã¿|è‚‰:ã«ã|é¦¬:ã°,ã†ã¾,ã¾|å£²:ã°ã„,ã†|è²·:ã°ã„,ã‹|éº¦:ã°ã,ã‚€ã|åŠ:ã¯ã‚“,ãªã‹|ç•ª:ã°ã‚“|çˆ¶:ãµ,ã¡ã¡|é¢¨:ãµã†,ãµ,ã‹ãœ,ã‹ã–|åˆ†:ã¶ã‚“,ãµã‚“,ã¶,ã‚|è:ã¶ã‚“,ã‚‚ã‚“,ã|ç±³:ã¹ã„,ã¾ã„,ã“ã‚|æ­©:ã»,ã¶,ãµ,ã‚ã‚‹,ã‚ã‚†|æ¯:ã¼,ã¯ã¯|æ–¹:ã»ã†,ã‹ãŸ|åŒ—:ã»ã,ããŸ|å¦¹:ã¾ã„,ã„ã‚‚ã†ã¨|æ¯:ã¾ã„|ä¸‡:ã¾ã‚“,ã°ã‚“|æ˜:ã‚ã„,ã¿ã‚‡ã†,ã‚,ã‚ã‹,ã‚ã|é³´:ã‚ã„,ãª|æ¯›:ã‚‚ã†,ã‘|é–€:ã‚‚ã‚“,ã‹ã©|å¤œ:ã‚„,ã‚ˆ,ã‚ˆã‚‹|é‡:ã‚„,ã®|å‹:ã‚†ã†,ã¨ã‚‚|ç”¨:ã‚ˆã†,ã‚‚ã¡|æ›œ:ã‚ˆã†|æ¥:ã‚‰ã„,ã,ããŸ,ã“|é‡Œ:ã‚Š,ã•ã¨|ç†:ã‚Š|è©±:ã‚,ã¯ãªã—,ã¯ãª
       `;
        
        // --- ãƒ‡ãƒ¼ã‚¿è§£æ (å…ƒã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å†åˆ©ç”¨) ---
        const searchDB = [];
        const gradeColors = { 1:"#FF8A65", 2:"#FFD54F", 3:"#4FC3F7", 4:"#81C784", 5:"#BA68C8", 6:"#7986CB" };

        rawData.trim().split('\n').forEach(line => {
            line = line.trim();
            if(!line) return;
            const parts = line.split('|');
            const grade = parseInt(parts[0]);
            
            for(let i=1; i<parts.length; i++) {
                const entry = parts[i].split(':');
                const char = entry[0];
                const readings = entry[1] ? entry[1].split(',') : [];
                searchDB.push({ char: char, readings: readings, grade: grade });
            }
        });

        // --- ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ç®¡ç† ---
        function getProgress() {
            const defaultData = {
                visitedGrades: {}, lastLoginDate: "", dailyCount: 0,
                currentCourse: "A", xp: { A: 0, B: 0, C: 0, D: 0, E: 0 }
            };
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                return data ? { ...defaultData, ...JSON.parse(data) } : defaultData;
            } catch (e) { return defaultData; }
        }
        function saveProgress(progress) {
            try { localStorage.setItem(STORAGE_KEY, JSON.stringify(progress)); } catch (e) {}
        }

        // --- XPãƒ»æ¼”å‡ºé–¢é€£ ---
        function showLevelUpPopup(newLevel, char) {
            const popup = document.getElementById('levelup-popup');
            document.getElementById('levelup-emoji').textContent = char;
            document.getElementById('levelup-char').textContent = `Lv.${newLevel} ã«é€²åŒ–ï¼`;
            popup.classList.add('show');
            setTimeout(() => popup.classList.remove('show'), 2500);
        }

        function updateXP() {
            let progress = getProgress();
            const today = new Date().toDateString();

            if (progress.lastLoginDate !== today) {
                progress.lastLoginDate = today;
                progress.dailyCount = 0;
            }

            if (progress.dailyCount < MAX_DAILY_XP) {
                progress.dailyCount++;
                const course = progress.currentCourse;
                const oldXP = progress.xp[course];
                
                if (oldXP < MAX_LEVEL) {
                    progress.xp[course]++;
                    const newXP = progress.xp[course];
                    const oldStage = Math.floor(oldXP / EVOLUTION_STEP);
                    const newStage = Math.floor(newXP / EVOLUTION_STEP);
                    if (newStage > oldStage) {
                        const newChar = COURSES[course].chars[newStage];
                        showLevelUpPopup(newXP, newChar);
                    }
                }
            }
            saveProgress(progress);
            renderTopBar();
        }

        function renderTopBar() {
            const progress = getProgress();
            const courseID = progress.currentCourse;
            const currentXP = progress.xp[courseID];
            
            const stageIndex = Math.min(Math.floor(currentXP / EVOLUTION_STEP), 10);
            const char = COURSES[courseID].chars[stageIndex];
            const nextEvo = (stageIndex + 1) * EVOLUTION_STEP;
            const remaining = (currentXP >= MAX_LEVEL) ? 0 : (nextEvo - currentXP);
            
            let percent;
            if (currentXP >= MAX_LEVEL) { percent = 100; } 
            else {
                const currentStageStart = stageIndex * EVOLUTION_STEP;
                percent = ((currentXP - currentStageStart) / EVOLUTION_STEP) * 100;
            }

            document.getElementById('current-char').textContent = char;
            document.getElementById('current-lvl').textContent = currentXP;
            // ã‚¢ãƒ—ãƒªç”»é¢å´ã®è¡¨ç¤ºã‚‚æ›´æ–°
            document.querySelectorAll('.current-xp-display').forEach(el => el.textContent = currentXP);

            const fillEl = document.getElementById('xp-fill');
            fillEl.style.width = percent + "%";
            
            if (currentXP >= MAX_LEVEL) {
                 document.getElementById('next-xp').textContent = "MAX";
                 fillEl.style.background = "linear-gradient(90deg, #FFD54F, #FFCA28)";
            } else {
                 document.getElementById('next-xp').textContent = remaining;
                 fillEl.style.background = "linear-gradient(90deg, #4FC3F7, #29B6F6)";
            }
        }

        // --- ã‚³ãƒ¼ã‚¹å¤‰æ›´ãƒ»ãƒªã‚»ãƒƒãƒˆãƒ»æ¤œç´¢ï¼ˆå…ƒã®ã¾ã¾ï¼‰ ---
        function openCourseModal() {
            const modal = document.getElementById('course-modal');
            const listContainer = document.getElementById('course-list');
            const progress = getProgress();
            const currentCourse = progress.currentCourse;
            listContainer.innerHTML = '';

            for (const [key, data] of Object.entries(COURSES)) {
                const isActive = (key === currentCourse);
                const xp = progress.xp[key] || 0;
                const stageIndex = Math.min(Math.floor(xp / EVOLUTION_STEP), 10);
                const charIcon = data.chars[stageIndex];

                const div = document.createElement('div');
                div.className = `course-option ${isActive ? 'active' : ''}`;
                div.onclick = () => selectCourse(key);
                div.innerHTML = `
                    <div class="co-icon">${charIcon}</div>
                    <div class="co-name">${data.name}
                        <div class="co-level" style="font-weight:normal; font-size:0.8rem; margin-top:2px;">Lv.${xp}</div>
                    </div>
                    <div class="co-status">${isActive ? 'é¸æŠä¸­ âœ…' : 'ãã‚Šã‹ãˆã‚‹'}</div>
                `;
                listContainer.appendChild(div);
            }
            modal.style.display = 'flex';
        }

        function selectCourse(courseKey) {
            let progress = getProgress();
            if (progress.currentCourse !== courseKey) {
                progress.currentCourse = courseKey;
                saveProgress(progress);
                renderTopBar();
            }
            document.getElementById('course-modal').style.display = 'none';
        }
        function closeCourseModal(e) { if (e.target.id === 'course-modal') e.target.style.display = 'none'; }
        function showResetConfirm() { document.getElementById('reset-confirm-overlay').style.display = 'flex'; }
        function cancelReset() { document.getElementById('reset-confirm-overlay').style.display = 'none'; }
        function confirmReset() { localStorage.clear(); location.reload(); }

        const searchInput = document.getElementById('search-input');
        const searchResults = document.getElementById('search-results');

        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.trim();
            searchResults.innerHTML = '';
            if (!query) { searchResults.style.display = 'none'; return; }
            const queryLower = query.toLowerCase();
            const limitMatches = searchDB.filter(item => {
                if (item.char === query) return true;
                return item.readings.some(r => r.toLowerCase().includes(queryLower));
            }).slice(0, 20);

            if (limitMatches.length > 0) {
                limitMatches.forEach(m => {
                    const div = document.createElement('div');
                    div.className = 'result-card';
                    const color = gradeColors[m.grade];
                    div.innerHTML = `
                        <div class="res-left"><span class="res-char" style="color:${color}">${m.char}</span>
                            <div><div style="font-weight:bold; font-size:0.9rem;">${m.grade}å¹´ç”Ÿ</div>
                            <div class="res-reading">${m.readings.join(' / ')}</div></div></div>
                        <span class="res-badge" style="background:${color}">ç·´ç¿’ã™ã‚‹</span>
                    `;
                    div.onclick = () => {
                        searchResults.style.display = 'none';
                        searchInput.value = '';
                        launchApp(m.grade, m.char); // è©²å½“ã®æ–‡å­—ã¸ç›´æ¥é£›ã¶
                    };
                    searchResults.appendChild(div);
                });
                searchResults.style.display = 'block';
            } else {
                searchResults.innerHTML = '<div style="padding:15px; color:#999; text-align:center;">è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸğŸ˜¢</div>';
                searchResults.style.display = 'block';
            }
        });

        // --- â–¼â–¼â–¼ ã“ã“ãŒå¤‰æ›´ç®‡æ‰€ï¼šã‚¢ãƒ—ãƒªèµ·å‹•ãƒ­ã‚¸ãƒƒã‚¯ â–¼â–¼â–¼ ---

        let currentAppList = [];
        let currentAppIndex = 0;
        let writer = null;

        // grade:å­¦å¹´, specificChar:(æ¤œç´¢ã‹ã‚‰æ¥ãŸå ´åˆã®)ç‰¹å®šã®æ–‡å­—
        function launchApp(grade, specificChar = null) {
            // 1. ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
            currentAppList = searchDB.filter(item => item.grade === grade);
            if (currentAppList.length === 0) { alert("ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"); return; }

            // 2. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¨­å®š
            if (specificChar) {
                const idx = currentAppList.findIndex(item => item.char === specificChar);
                currentAppIndex = (idx !== -1) ? idx : 0;
            } else {
                currentAppIndex = 0;
            }

            // 3. ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('portal-screen').style.display = 'none';
            document.getElementById('practice-screen').style.display = 'flex';
            document.getElementById('app-grade-label').textContent = grade + "ã­ã‚“ã›ã„";

            // 4. æ›¸ãå–ã‚Šé–‹å§‹
            loadKanji();
        }

        function exitApp() {
            document.getElementById('practice-screen').style.display = 'none';
            document.getElementById('portal-screen').style.display = 'flex';
            renderTopBar(); // XPè¡¨ç¤ºæ›´æ–°
        }

        function loadKanji() {
            const data = currentAppList[currentAppIndex];
            const infoText = `${data.char} (${data.readings[0] || ''})`;
            document.getElementById('kanji-info').textContent = infoText;
            document.getElementById('feedback-msg').textContent = "";
            document.getElementById('drawing-board').innerHTML = ""; // ã‚¯ãƒªã‚¢

            // HanziWriter ç”Ÿæˆ
            writer = HanziWriter.create('drawing-board', data.char, {
                width: 300, height: 300, padding: 20,
                strokeColor: '#333',
                drawingWidth: 20, // ç·šã®å¤ªã•
                showOutline: true, // ä¸‹çµµè¡¨ç¤º
                outlineColor: '#ddd',
                showCharacter: false, // ãªãã‚Šæ›¸ããƒ¢ãƒ¼ãƒ‰
                quiz: {
                    onMistake: function(strokeData) {
                        document.getElementById('feedback-msg').textContent = "ãŠã—ã„ï¼";
                    },
                    onCorrectStroke: function(strokeData) {
                        document.getElementById('feedback-msg').textContent = "ã„ã„æ„Ÿã˜ï¼";
                    },
                    onComplete: function(summaryData) {
                        document.getElementById('feedback-msg').textContent = "ã§ããŸï¼âœ¨";
                        updateXP(); // 1æ–‡å­—å®Œäº†ã§XPåŠ ç®—
                        setTimeout(nextChar, 1000); // 1ç§’å¾Œã«è‡ªå‹•ã§æ¬¡ã¸
                    }
                }
            });
            writer.quiz(); // ã‚¯ã‚¤ã‚ºãƒ¢ãƒ¼ãƒ‰é–‹å§‹
        }

        function nextChar() {
            if (currentAppIndex < currentAppList.length - 1) {
                currentAppIndex++;
                loadKanji();
            } else {
                alert("ã“ã®å­¦å¹´ã®æ¼¢å­—ã¯ã“ã‚Œã§ãŠã—ã¾ã„ã§ã™ï¼ã™ã”ã„ï¼");
                exitApp();
            }
        }

        function prevChar() {
            if (currentAppIndex > 0) {
                currentAppIndex--;
                loadKanji();
            }
        }

        function retryChar() {
            loadKanji();
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
               if(document.getElementById('practice-screen').style.display === 'flex') exitApp();
               else cancelReset();
            }
        });

        // åˆæœŸåŒ–
        renderTopBar();
    </script>
 </body>
</html>
